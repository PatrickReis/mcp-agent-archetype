# ğŸ¤– MCP Agent Archetype

> **ArquÃ©tipo para desenvolvimento de agentes MCP (Model Context Protocol) na Cielo**

Um framework robusto e extensÃ­vel para criar agentes MCP com estruturas mÃ­nimas ou completas, dependendo das suas necessidades de projeto.

## ğŸ“‹ Ãndice

- [ğŸš€ InÃ­cio RÃ¡pido](#-inÃ­cio-rÃ¡pido)
- [ğŸ“Š Tipos de Setup](#-tipos-de-setup)
- [ğŸ—ï¸ Estruturas Geradas](#ï¸-estruturas-geradas)
- [ğŸ¤– Criando Seu Primeiro Agente](#-criando-seu-primeiro-agente)
- [ğŸ“š Guia Completo](#-guia-completo)
- [ğŸ§ª Testes](#-testes)
- [ğŸ”§ Comandos Ãšteis](#-comandos-Ãºteis)
- [ğŸ“– ReferÃªncia da API](#-referÃªncia-da-api)

## ğŸš€ InÃ­cio RÃ¡pido

### PrÃ©-requisitos

- **Python 3.11+**
- **Git**
- **pip** ou **Poetry** (dependendo do setup escolhido)

### InstalaÃ§Ã£o

```bash
# 1. Clone o repositÃ³rio do archetype
git clone <repo-url>
cd mcp-agent-archetype

# 2. Torne o script executÃ¡vel
chmod +x gerar_projeto.sh

# 3. Crie seu projeto
./gerar_projeto.sh minimal meu-agente-mcp
```

## ğŸ“Š Tipos de Setup

### ğŸ¯ **Setup Minimal**
Ideal para **prototipagem rÃ¡pida** e **projetos simples**

```bash
./gerar_projeto.sh minimal meu-projeto-simples
```

**CaracterÃ­sticas:**
- âœ… Core MCP framework completo
- âœ… Exemplo funcional incluÃ­do  
- âœ… Estrutura de testes bÃ¡sica
- âœ… Scripts de utilitÃ¡rios
- âœ… ConfiguraÃ§Ã£o com pip/setuptools
- âœ… Pronto para uso imediato

### ğŸ¢ **Setup Full**
Ideal para **projetos enterprise** e **produÃ§Ã£o**

```bash
./gerar_projeto.sh full meu-projeto-enterprise
```

**CaracterÃ­sticas:**
- âœ… Tudo do setup minimal +
- âœ… Arquitetura modular avanÃ§ada
- âœ… Middleware e protocolos
- âœ… Poetry para gerenciamento de dependÃªncias
- âœ… Docker e Kubernetes ready
- âœ… CI/CD com GitHub Actions
- âœ… Monitoramento e observabilidade
- âœ… DocumentaÃ§Ã£o API automÃ¡tica

## ğŸ—ï¸ Estruturas Geradas

### Setup Minimal
```
meu-projeto/
â”œâ”€â”€ ğŸ“ src/
â”‚   â”œâ”€â”€ ğŸ“ mcp_agent/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ base_agent.py          # ğŸ—ï¸ Core MCP framework
â”‚   â”œâ”€â”€ ğŸ“ agents/                 # ğŸ¤– Seus agentes aqui
â”‚   â”œâ”€â”€ ğŸ“ examples/
â”‚   â”‚   â””â”€â”€ simple_agent.py        # ğŸ’¡ Exemplo funcional
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ ğŸ“ tests/                      # ğŸ§ª Testes
â”œâ”€â”€ ğŸ“ config/                     # âš™ï¸ ConfiguraÃ§Ãµes
â”œâ”€â”€ ğŸ“ scripts/
â”‚   â””â”€â”€ create_agent.py            # ğŸ“œ Gerador de agentes
â”œâ”€â”€ requirements.txt               # ğŸ“¦ DependÃªncias
â”œâ”€â”€ requirements-dev.txt           # ğŸ› ï¸ Deps desenvolvimento
â”œâ”€â”€ pyproject.toml                 # ğŸ”§ ConfiguraÃ§Ã£o projeto
â”œâ”€â”€ Makefile                       # ğŸ¯ Comandos Ãºteis
â”œâ”€â”€ .gitignore                     # ğŸ“ Git ignore
â””â”€â”€ README.md                      # ğŸ“– DocumentaÃ§Ã£o
```

### Setup Full
```
meu-projeto/
â”œâ”€â”€ ğŸ“ src/
â”‚   â”œâ”€â”€ ğŸ“ mcp_agent/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ core/               # ğŸ—ï¸ Core framework
â”‚   â”‚   â”œâ”€â”€ ğŸ“ protocols/          # ğŸ”Œ Protocolos MCP
â”‚   â”‚   â”œâ”€â”€ ğŸ“ utils/              # ğŸ› ï¸ UtilitÃ¡rios
â”‚   â”‚   â””â”€â”€ ğŸ“ middleware/         # ğŸ”„ Middleware
â”‚   â”œâ”€â”€ ğŸ“ agents/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ data_processor/     # ğŸ“Š Processamento dados
â”‚   â”‚   â””â”€â”€ ğŸ“ notification_service/ # ğŸ“¨ NotificaÃ§Ãµes
â”‚   â””â”€â”€ ğŸ“ examples/
â”œâ”€â”€ ğŸ“ tests/
â”‚   â”œâ”€â”€ ğŸ“ unit/                   # ğŸ§ª Testes unitÃ¡rios
â”‚   â””â”€â”€ ğŸ“ integration/            # ğŸ”— Testes integraÃ§Ã£o
â”œâ”€â”€ ğŸ“ deployment/
â”‚   â”œâ”€â”€ ğŸ“ kubernetes/             # â˜¸ï¸ K8s configs
â”‚   â””â”€â”€ ğŸ“ helm/                   # ğŸ“Š Helm charts
â”œâ”€â”€ ğŸ“ monitoring/                 # ğŸ“ˆ Observabilidade
â”œâ”€â”€ ğŸ“ .github/workflows/          # ğŸ”„ CI/CD
â”œâ”€â”€ pyproject.toml                 # ğŸ­ Poetry config
â”œâ”€â”€ Dockerfile                     # ğŸ³ Container
â””â”€â”€ README.md
```

## ğŸ¤– Criando Seu Primeiro Agente

### Passo 1: Gerar o Projeto

```bash
# Setup mÃ­nimo (recomendado para comeÃ§ar)
./gerar_projeto.sh minimal meu-primeiro-agente
cd meu-primeiro-agente
```

### Passo 2: Configurar Ambiente

```bash
# Criar ambiente virtual
python -m venv venv
source venv/bin/activate  # Linux/Mac
# ou: venv\Scripts\activate  # Windows

# Instalar dependÃªncias
pip install -r requirements.txt
pip install -r requirements-dev.txt
```

### Passo 3: Testar a Base

```bash
# Executar exemplo incluÃ­do
python -m src.examples.simple_agent

# Executar testes
pytest tests/ -v
```

### Passo 4: Criar Seu Agente

```bash
# Usar o gerador automÃ¡tico
make create-agent NAME=processador_dados

# Ou manualmente
mkdir -p src/agents/meu_agente
```

### Passo 5: Implementar o Agente

```python
# src/agents/meu_agente/agent.py
from src.mcp_agent.base_agent import BaseMCPAgent, AgentConfig, MCPMessage
import asyncio

class MeuAgente(BaseMCPAgent):
    """Meu primeiro agente MCP"""
    
    async def _custom_initialize(self):
        """InicializaÃ§Ã£o personalizada"""
        self.logger.info("Inicializando meu agente...")
        # Sua lÃ³gica de setup aqui
        await asyncio.sleep(0.1)
    
    async def _process_custom_message(self, message: MCPMessage):
        """Processamento de mensagens"""
        message_type = message.message_type.lower()
        
        if message_type == "processar":
            # Sua lÃ³gica de processamento
            dados = message.payload.get("dados", [])
            resultado = self._processar_dados(dados)
            
            return {
                "status": "processado",
                "resultado": resultado,
                "timestamp": message.timestamp.isoformat()
            }
        
        elif message_type == "ping":
            return {"response": "pong", "agent": "meu_agente"}
        
        else:
            raise ValueError(f"Tipo de mensagem nÃ£o suportado: {message_type}")
    
    def _processar_dados(self, dados):
        """LÃ³gica especÃ­fica do seu domÃ­nio"""
        # Implementar sua lÃ³gica aqui
        return f"Processados {len(dados)} itens"

# Exemplo de uso
async def main():
    config = AgentConfig(
        agent_id="meu_agente_001",
        agent_name="Meu Agente",
        version="1.0.0",
        description="Meu primeiro agente MCP"
    )
    
    agente = MeuAgente(config)
    
    if await agente.initialize():
        # Testar o agente
        mensagem = agente.create_message("processar", {
            "dados": [1, 2, 3, 4, 5]
        })
        
        resposta = await agente.process_message(mensagem)
        print(f"Resposta: {resposta.data}")
    
if __name__ == "__main__":
    asyncio.run(main())
```

### Passo 6: Testar Seu Agente

```python
# tests/test_meu_agente.py
import pytest
from src.agents.meu_agente.agent import MeuAgente
from src.mcp_agent.base_agent import AgentConfig

@pytest.fixture
def agente_config():
    return AgentConfig(
        agent_id="test_agente",
        agent_name="Test Agente",
        version="1.0.0",
        description="Agente para testes"
    )

@pytest.mark.asyncio
async def test_agente_inicializa(agente_config):
    agente = MeuAgente(agente_config)
    resultado = await agente.initialize()
    assert resultado is not None

@pytest.mark.asyncio
async def test_processa_mensagem(agente_config):
    agente = MeuAgente(agente_config)
    await agente.initialize()
    
    mensagem = agente.create_message("processar", {"dados": [1, 2, 3]})
    resposta = await agente.process_message(mensagem)
    
    assert resposta.success is True
    assert "processados" in resposta.data["resultado"].lower()
```

## ğŸ“š Guia Completo

### Conceitos Fundamentais

#### ğŸ—ï¸ **BaseMCPAgent**
Classe base que todos os agentes devem herdar:

- **Gerenciamento de estado** (INITIALIZING, READY, PROCESSING, ERROR, SHUTDOWN)
- **Sistema de logging** configurÃ¡vel
- **Processamento de mensagens** assÃ­ncrono
- **Tratamento de erros** robusto

#### ğŸ“¨ **MCPMessage**
Estrutura padrÃ£o para comunicaÃ§Ã£o:

```python
@dataclass
class MCPMessage:
    id: str                        # Identificador Ãºnico
    timestamp: datetime            # Timestamp da mensagem
    agent_id: str                 # ID do agente remetente
    message_type: str             # Tipo da mensagem
    payload: Dict[str, Any]       # Dados da mensagem
    metadata: Optional[Dict[str, Any]] = None  # Metadados opcionais
```

#### âœ… **AgentResponse**
Resposta padronizada:

```python
@dataclass
class AgentResponse:
    success: bool                 # Se a operaÃ§Ã£o foi bem-sucedida
    data: Any = None             # Dados de resposta
    error: Optional[str] = None  # Mensagem de erro (se houver)
```

### PadrÃµes de ImplementaÃ§Ã£o

#### ğŸ”„ **Ciclo de Vida do Agente**

1. **CriaÃ§Ã£o** â†’ Instancia com `AgentConfig`
2. **InicializaÃ§Ã£o** â†’ Chama `initialize()`
3. **Processamento** â†’ Recebe e processa `MCPMessage`
4. **FinalizaÃ§Ã£o** â†’ Chama `shutdown()` (se necessÃ¡rio)

#### ğŸ¯ **Tipos de Mensagem Recomendados**

| Tipo | DescriÃ§Ã£o | Exemplo de Payload |
|------|-----------|-------------------|
| `ping` | Teste de conectividade | `{}` |
| `status` | Status do agente | `{}` |
| `process` | Processamento principal | `{"data": [...]}` |
| `configure` | ConfiguraÃ§Ã£o dinÃ¢mica | `{"settings": {...}}` |
| `shutdown` | FinalizaÃ§Ã£o graceful | `{}` |

### ConfiguraÃ§Ã£o AvanÃ§ada

#### ğŸ“Š **Logging Personalizado**

```python
config = AgentConfig(
    agent_id="meu_agente",
    agent_name="Meu Agente",
    version="1.0.0",
    description="Agente com logging avanÃ§ado",
    log_level="DEBUG"  # DEBUG, INFO, WARNING, ERROR
)
```

#### âš™ï¸ **ConfiguraÃ§Ã£o por Arquivo**

```yaml
# config/agent_config.yaml
agent:
  id: "processador_001"
  name: "Processador de Dados"
  version: "2.1.0"
  log_level: "INFO"

settings:
  batch_size: 100
  timeout: 30
  max_retries: 3
```

```python
# Carregar configuraÃ§Ã£o
import yaml

with open("config/agent_config.yaml") as f:
    config_dict = yaml.safe_load(f)

config = AgentConfig(**config_dict["agent"])
```

## ğŸ§ª Testes

### Estrutura de Testes

```bash
tests/
â”œâ”€â”€ conftest.py                 # Fixtures compartilhadas
â”œâ”€â”€ test_base_agent.py         # Testes da classe base
â”œâ”€â”€ unit/
â”‚   â””â”€â”€ test_meu_agente.py     # Testes unitÃ¡rios
â””â”€â”€ integration/
    â””â”€â”€ test_agent_integration.py  # Testes de integraÃ§Ã£o
```

### Fixtures Ãšteis

```python
# tests/conftest.py
import pytest
from src.mcp_agent.base_agent import AgentConfig

@pytest.fixture
def agent_config():
    return AgentConfig(
        agent_id="test_agent",
        agent_name="Test Agent",
        version="1.0.0",
        description="Agent for testing"
    )

@pytest.fixture
async def initialized_agent(agent_config):
    from src.agents.meu_agente.agent import MeuAgente
    agent = MeuAgente(agent_config)
    await agent.initialize()
    yield agent
    # Cleanup se necessÃ¡rio
```

### Executar Testes

```bash
# Todos os testes
pytest tests/ -v

# Testes especÃ­ficos
pytest tests/unit/ -v

# Com cobertura
pytest tests/ --cov=src --cov-report=html

# Testes de performance
pytest tests/ --benchmark-only
```

## ğŸ”§ Comandos Ãšteis

### Makefile (Setup Minimal)

```bash
# Instalar dependÃªncias de desenvolvimento
make install-dev

# Executar testes
make test

# Executar exemplo
make run

# Criar novo agente
make create-agent NAME=processador_vendas

# Ajuda
make help
```

### Poetry (Setup Full)

```bash
# Instalar dependÃªncias
poetry install

# Adicionar nova dependÃªncia
poetry add requests

# Executar dentro do ambiente
poetry run python -m src.examples.simple_agent

# Shell do ambiente
poetry shell
```

### Scripts Personalizados

```bash
# Gerar documentaÃ§Ã£o da API
python scripts/generate_docs.py

# Executar linting
python scripts/lint.py

# Deploy para staging
python scripts/deploy.py --env staging
```

## ğŸ“– ReferÃªncia da API

### Classes Principais

#### `BaseMCPAgent`

```python
class BaseMCPAgent(ABC):
    def __init__(self, config: AgentConfig)
    async def initialize() -> None
    async def process_message(self, message: MCPMessage) -> AgentResponse
    def create_message(self, message_type: str, payload: Dict[str, Any]) -> MCPMessage
    
    # MÃ©todos abstratos para implementar
    @abstractmethod
    async def _custom_initialize(self) -> None
    @abstractmethod
    async def _process_custom_message(self, message: MCPMessage) -> Any
```

#### `AgentConfig`

```python
@dataclass
class AgentConfig:
    agent_id: str           # Identificador Ãºnico do agente
    agent_name: str         # Nome amigÃ¡vel
    version: str            # VersÃ£o do agente
    description: str        # DescriÃ§Ã£o do agente
    log_level: str = "INFO" # NÃ­vel de logging
```

#### `MCPMessage`

```python
@dataclass
class MCPMessage:
    id: str                                    # ID Ãºnico da mensagem
    timestamp: datetime                        # Timestamp
    agent_id: str                             # ID do agente remetente
    message_type: str                         # Tipo da mensagem
    payload: Dict[str, Any]                   # Dados
    metadata: Optional[Dict[str, Any]] = None # Metadados
```

#### `AgentResponse`

```python
@dataclass
class AgentResponse:
    success: bool                   # Sucesso da operaÃ§Ã£o
    data: Any = None               # Dados de resposta
    error: Optional[str] = None    # Mensagem de erro
```

### Enums

#### `AgentStatus`

```python
class AgentStatus(Enum):
    INITIALIZING = "initializing"  # Inicializando
    READY = "ready"               # Pronto para processar
    PROCESSING = "processing"     # Processando mensagem
    ERROR = "error"              # Estado de erro
    SHUTDOWN = "shutdown"        # Finalizado
```

---

## ğŸš€ PrÃ³ximos Passos

1. **Escolha o setup** adequado ao seu projeto
2. **Gere a estrutura** com o script
3. **Implemente seu primeiro agente** seguindo os exemplos
4. **Escreva testes** para garantir qualidade
5. **Configure CI/CD** (setup full) para automaÃ§Ã£o
6. **Monitore em produÃ§Ã£o** com as ferramentas incluÃ­das

## ğŸ¤ ContribuiÃ§Ã£o

Encontrou um bug ou tem uma sugestÃ£o? Abra uma issue ou envie um PR!

## ğŸ“„ LicenÃ§a

MIT License - veja o arquivo LICENSE para detalhes.

---

**Desenvolvido com â¤ï¸ pela equipe Cielo**